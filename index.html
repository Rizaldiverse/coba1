<!DOCTYPE html>
<html>
<head>
  <title>Hitung Ongkos Kirim</title>
  <!-- Tambahkan jQuery dan Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    const apiKey = 'aa01e82b3abbdd4958a0c3857d0a1a97';

    async function getKota() {
      const url = `https://api.rajaongkir.com/starter/city`;
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'key': apiKey
        }
      });
      const data = await response.json();
      return data.rajaongkir.results;
    }

    async function getKecamatan(cityId) {
      const url = `https://api.rajaongkir.com/starter/subdistrict?city=${cityId}`;
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'key': apiKey
        }
      });
      const data = await response.json();
      return data.rajaongkir.results;
    }

    async function getOngkosKirim(origin, destination, weight) {
      const url = `https://api.rajaongkir.com/starter/cost`;
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'key': apiKey
        },
        body: JSON.stringify({
          origin: origin,
          destination: destination,
          weight: weight,
          courier: 'jne'
        })
      });
      const data = await response.json();
      return data.rajaongkir.results[0].costs[0].cost[0].value;
    }

    async function populateKotaDropdown() {
      const kotaDropdown = document.getElementById('kota');
      const kotas = await getKota();

      kotas.forEach(kota => {
        const option = document.createElement('option');
        option.value = kota.city_id;
        option.text = kota.city_name;
        kotaDropdown.add(option);
      });

      // Inisialisasi Select2 setelah menambahkan semua kota
      $('#kota').select2();
    }

    async function populateKecamatanDropdown(cityId) {
      const kecamatanDropdown = document.getElementById('kecamatan');
      const kecamatans = await getKecamatan(cityId);

      kecamatanDropdown.innerHTML = ''; // Kosongkan dropdown

      kecamatans.forEach(kecamatan => {
        const option = document.createElement('option');
        option.value = kecamatan.subdistrict_id;
        option.text = kecamatan.subdistrict_name;
        kecamatanDropdown.add(option);
      });

      // Inisialisasi Select2 setelah menambahkan semua kecamatan
      $('#kecamatan').select2();
    }

    async function calculateTotalCost() {
      const origin = '501'; // Kode kota/kabupaten asal (misalnya, Semarang)
      const destination = document.getElementById('kecamatan').value;
      const weight = 1000; // Berat paket dalam gram (disesuaikan dengan berat aktual)
      const productCost = 20000; // Contoh harga produk (disesuaikan dengan harga aktual)

      const shippingCost = await getOngkosKirim(origin, destination, weight);
      const totalCost = productCost + shippingCost;

      document.getElementById('total').innerText = `Total: Rp ${totalCost}`;
      document.getElementById('shippingCost').innerText = `Ongkos Kirim: Rp ${shippingCost}`;
    }

    async function submitData() {
      const data = {
        nama: document.getElementById('nama').value,
        email: document.getElementById('email').value,
        nomorWhatsapp: document.getElementById('nomorWhatsapp').value,
        ukuranBanner: document.getElementById('ukuranBanner').value,
        kota: document.getElementById('kota').options[document.getElementById('kota').selectedIndex].text,
        kecamatan: document.getElementById('kecamatan').options[document.getElementById('kecamatan').selectedIndex].text,
        ongkosKirim: document.getElementById('shippingCost').innerText.split('Rp ')[1],
        totalBiaya: document.getElementById('total').innerText.split('Rp ')[1]
      };

      const response = await fetch('YOUR_WEB_APP_URL', { // Ganti YOUR_WEB_APP_URL dengan URL web app Anda
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      if (result.status === "success") {
        alert("Data berhasil disimpan!");
      } else {
        alert("Gagal menyimpan data.");
      }
    }

    $(document).ready(function() {
      // Inisialisasi Select2
      $('#kota').select2();
      $('#kecamatan').select2();

      // Populate kota dropdown on page load
      populateKotaDropdown();

      // Event handler untuk perubahan kota
      $('#kota').change(function() {
        const cityId = $(this).val();
        populateKecamatanDropdown(cityId);
      });
    });
  </script>
</head>
<body>
  <h1>Hitung Ongkos Kirim</h1>
  <form>
    <label for="nama">Nama:</label>
    <input type="text" id="nama" name="nama" required><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br>

    <label for="nomorWhatsapp">Nomor WhatsApp:</label>
    <input type="text" id="nomorWhatsapp" name="nomorWhatsapp" required><br>

    <label for="ukuranBanner">Ukuran Banner (cm):</label>
    <select id="ukuranBanner" name="ukuranBanner" required>
      <option value="100x200">100x200</option>
      <option value="200x300">200x300</option>
      <option value="300x400">300x400</option>
    </select><br>

    <label for="kota">Kota:</label>
    <select id="kota" name="kota" required>
      <!-- Kota akan
